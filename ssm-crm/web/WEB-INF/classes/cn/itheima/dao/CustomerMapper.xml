<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.itheima.dao.CustomerMapper">


    <sql id="customer_where">
        <where>
            <if test="custName != null and custName != ''">
                and a.cust_name LIKE '%${custName}%'
            </if>
            <if test="custSource != null and custSource != ''">
                and a.cust_source = #{custSource}
            </if>
            <if test="custIndustry != null and custIndustry != ''">
                and a.cust_industry=#{custIndustry}
            </if>
            <if test="custLevel != null and custLevel != ''">
                and a.cust_level=#{custLevel}
            </if>
        </where>
    </sql>


    <select id="findCustomerByVo" parameterType="cn.itheima.pojo.QueryVo" resultType="cn.itheima.pojo.Customer">
        select a.cust_id, a.cust_name ,b.dict_item_name cust_source,c.dict_item_name cust_industry,
        d.dict_item_name cust_level,a.cust_mobile,a.cust_linkman,a.cust_zipcode,
        a.cust_address,a.cust_createtime
        from customer a
        LEFT JOIN base_dict b on cust_source = b.dict_id
        LEFT JOIN base_dict c on a.cust_industry = c.dict_id
        LEFT JOIN base_dict d on a.cust_level = d.dict_id
        <include refid="customer_where"></include>
        limit #{start},#{size}
    </select>


    <select id="findCustomerByVoCount" parameterType="cn.itheima.pojo.QueryVo" resultType="Integer">

        select count(*)
        from customer a
        LEFT JOIN base_dict b on cust_source = b.dict_id
        LEFT JOIN base_dict c on a.cust_industry = c.dict_id
        LEFT JOIN base_dict d on a.cust_level = d.dict_id
        <include refid="customer_where"></include>
    </select>
    
    
    <!--修改详情-->
    <select id="findCustomerById" parameterType="Long" resultType="cn.itheima.pojo.Customer">
        select * from customer where cust_id = #{id}
    </select>
</mapper>